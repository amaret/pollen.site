<!DOCTYPE html>
<html lang="en">

  <head>
    
    <!-- Meta, title, CSS, favicons, etc. -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="Pollen, a new programming language for tiny computers by Amaret, Inc.">
    <meta name="keywords" content="programming, programming languages, languages, hardware, microcontroller, embedded system, embedded systems, embedded systems programming, embedded development, microcontroller software, microcontroller software development">
    <meta name="author" content="Amaret, Inc.">

    <title>Programming Pollen</title>

    <!-- Bootstrap core CSS -->
    <link href="../../static/css/bootstrap.css" rel="stylesheet" />

    <!-- Prism CSS -->
    <link href="../../static/css/prism.css" rel="stylesheet" />

    <!-- Amaret core CSS -->
    <link href="../../static/css/pollen.css" rel="stylesheet" />

    <!-- Favicons -->
    <link rel="apple-touch-icon-precomposed" sizes="144x144" href="static/ico/apple-touch-icon-144-precomposed.png">
    <link rel="icon" href="static/ico/favicon.ico">

    <!-- analytics --> 
    <script></script>
  </head>

  <body class="doc-page language-javascript" data-spy="scroll" data-target="#doc-sidenav">

    <div class="navbar navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target=".navbar-collapse">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="http://localhost/~amichi/pollen/index.html">Pollen</a>
    </div>
    <div class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li id="introduction"><a href="http://localhost/~amichi/pollen/introduction/index.html">Introduction</a></li>
        <li><a href="http://localhost/~amichi/pollen/guide/index.html">Language Guide</a></li>
        <li><a href="http://localhost/~amichi/pollen/reference/index.html">Reference</a></li>
        <li><a href="http://localhost/~amichi/pollen/compiler/index.html">Compiler</a></li>
        <li><a href="">Support</a></li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li><a href="">About</a></li>
      </ul>
    </div>
  </div>
  <div class="alert alert-warning" role="alert" style="text-align: center; margin: 0">
    <p><span class="glyphicon glyphicon-road" aria-hidden="true"></span> This documentation is being worked on and is not yet in a releasable state. &nbsp;2015-04-21</p>
  <p>  </p>
</div>

</div>



    <div class="doc-header draft-mode">
      <div class="container">
        <h1>Programming Pollen</h1>
        <p>A practical guide to the Pollen language features and how to make use of them effectively.</p>
      </div>
    </div>

    <div class="container doc-container" style="padding-bottom: 60px">
      <div class="row" id="content">
        <div class="col-md-3">
  <nav id="doc-sidenav" class="doc-sidebar hidden-print hidden-xs hidden-sm" role="navigation">
    <h4>Language Guide</h4>
<ul class="nav doc-sidenav affix-top" data-spy="affix" data-offset-top="10" data-offset-bottom="200" style="margin-top: 0px">
  <li><a href="http://localhost/~amichi/pollen/guide">The Basics</a></li>
  <li><a href="http://localhost/~amichi/pollen/guide/operators">Basic Operators</a></li>
  <li><a href="http://localhost/~amichi/pollen/guide/strings">Strings and Characters</a></li>
  <li><a href="http://localhost/~amichi/pollen/guide/arrays">Arrays</a></li>
  <li><a href="http://localhost/~amichi/pollen/guide/control-flow">Control Flow</a></li>
  <li><a href="http://localhost/~amichi/pollen/guide/function-references">Function References</a></li>
  <li><a href="http://localhost/~amichi/pollen/guide/host-initialization">Host Initialization</a></li>
  <li><a href="http://localhost/~amichi/pollen/guide/modules">Modules</a></li>
  <li><a href="http://localhost/~amichi/pollen/guide/protocols">Protocols</a></li>  
  <li><a href="http://localhost/~amichi/pollen/guide/compositions">Compositions</a></li>
  <li><a href="http://localhost/~amichi/pollen/guide/classes">Classes</a></li>
  <li><a href="http://localhost/~amichi/pollen/guide/enumerations">Enumerations</a></li>
  <li><a href="http://localhost/~amichi/pollen/guide/meta">Meta Types</a></li>
  <li><a href="http://localhost/~amichi/pollen/guide/print-keyword">Print Keyword</a></li>
  <li><a href="http://localhost/~amichi/pollen/guide/intrinsics">Intrinsics</a></li>
  <li><a href="http://localhost/~amichi/pollen/guide/c-code">C Code Injection</a></li>
  <li><a href="http://localhost/~amichi/pollen/guide/packages-bundles">Packages &amp; Bundles</a></li>
  <li><a href="http://localhost/~amichi/pollen/guide/pollen-corelib">Core Library</a>
    <ul>
        <li><a href="http://localhost/~amichi/pollen/guide/pollen-events">Events</a></li>
        <li><a href="http://localhost/~amichi/pollen/guide/pollen-timers">Timers</a></li>
    </ul>
  </li>
  
</ul>

  </nav>
</div>

<div class="col-md-9" role="main">

  <h1 id="arrays" class="page-header">Arrays</h1>

<p class="lead">Arrays in Pollen can be declared with elements of primitive type, class type, and function reference type.</p>

<h2 class="page-header" id="ref-arrays-creation">
Creation and Initialization 
</h2>

<h4 class="page-header" id="ref-arrays-primitivetype">
Arrays of Primitive Type
</h4>

<p>Here are several arrays of primitive type, showing explicit as well as default initialization.</p>

<pre><code>uint8 arr1[3]             // array of 3 uint8, by default each element initialized to 0.

uint8 arr2[3] = {7}       // array of 3 uint8, each element initialized to 7.
</code></pre>

<p>The above arrays are target arrays. They will be initialized at load time. They must be initialized to constants, not variable values or function returns. </p>

<p>A host array has the attribute <code>host</code>. Here is a host array. It will be initialized during the host phase:</p>

<pre><code>host uint8 [3] arr3 = {5,5,7}   // host array of 3 uint8, initialized to 5,5,7.
</code></pre>

<p>Host arrays have the ability to be initialized to host variable values or values returned by host
functions.</p>

<pre><code>host uint8 arr4[3]  = { myHostVar, getVarOnHost(), getVarOnHost() }   // host array init to host values
</code></pre>

<p>For all arrays the type of the array is on the left and is followed by the array name. The specification of the size can follow either the type or the name.</p>

<div class="alert alert-info" role="alert">
  <span class="glyphicon glyphicon-eye-open"></span>
   Only single dimensional arrays are currently supported. Look for multi-dimensional arrays in the next release.
</div>

<h4 class="page-header" id="ref-arrays-classtype">
Arrays of Class Type
</h4>

<pre><code>    host LedState ledStates[2] = { new LedState(127) }
</code></pre>

<p>This is a host array of two Led states. The <code>new LedState()</code> call will invoke the host constructor so the array is allocated and initialized to two LedState elements statically. Target arrays are supported; they differ by the abscence of the <code>host</code> attribute.</p>

<pre><code>    LedState ledStates[3] = { null }        // initialized to 3 nulls
</code></pre>

<p>This target array is allocated and initialized to three null references to LedState objects at load time. Constructors cannot be called in target array initialization.</p>

<h4 class="page-header" id="ref-arrays-funrefs">
Arrays of Function References
</h4>

<p>Arrays can have an element type which is a function reference. The element type can be
a module function reference. </p>

<pre><code>  Mod.foo(uint8) bar                  // A function reference to Mod.foo()
  host Mod.foo foos[3] = { bar }      // Array of references to Mod.foo()
</code></pre>

<p>The element type can also be a protocol function reference. This is useful
in supporting generic code as the protocol function can be implemented by
multiple functions with the same signature. Iterating over the array provides a
generic way of calling these multiple functions. <code>LedProtocol</code> is a protocol which
contains the function declaration <code>on()</code>. </p>

<pre><code>  LedProtocol.on onFunctions[3] = { Led1.on, Led2.on, Led3.on }
</code></pre>

<p>The function references in the array have now been initialized to the <code>on</code> functions in modules which
implement the <code>LedProtocol</code>. </p>

<p>An example of generic code using arrays of function references is 
<a href="http://localhost/~amichi/pollen/guide/function-references#ref-funrefs-generic">here</a>.
More information on function references is 
<a href="http://localhost/~amichi/pollen/guide/function-references">here</a>.</p>

<div class="alert alert-info" role="alert">
  <span class="glyphicon glyphicon-leaf"></span>
  Class function references are not supported.
</div>

<div class="alert alert-warning" role="alert">
  <span class="glyphicon glyphicon-eye-open"></span>
   A function reference cannot be initialized to a host function. 
</div>

<h4 class="page-header" id="ref-arrays-nodim">
Arrays Without Dimension and the Pegging Operator
</h4>

<p>Arrays can be declared with no dimension at all. That is, there is no dimension
and also no initializer. Such arrays are not allocated
as arrays, they are array references. These kinds of references can be pegged (using the pegging operator <code>@=</code>) to other arrays at runtime. 
Only arrays declared without dimension can be pegged. A pegged array <em>overlays</em> in memory 
the array to which it was pegged.</p>

<pre><code>    byte arrayNoDim[]    // no initializer!
</code></pre>

<p>Here is an array of characters:</p>

<pre><code>    byte arrayString[] = { 'h', 'e', 'l', 'l', 'o' , ' ', 'm', 'a', 'r', 'y'}
</code></pre>

<p>The first array can be pegged to the second array and then accessed through it:</p>

<pre><code>    arrayNoDim @= arrayString       // array pegging
    string str = arraryNoDim[6]
    print str                       // prints 'mary'
</code></pre>

<p>A <code>uint32</code> array can be pegged to a <code>uint8</code> (or <code>bool</code>, <code>int16</code>, etc.) array and vice versa. This is useful for
flexible memory access and it can also be used to obtain some of the functionality of a type cast as shown below. </p>

<pre><code>   uint8 u8[4] = {0,1,2,3}
   uint32 u32[] 
   bool   b[] 

   u32 @= u8        // access the source as an unsigned 32 bit
   b   @= u8        // access the source as a boolean
</code></pre>

<p>An array without dimension can also be pegged to a class reference, allowing
access to the object as if it were overlaid by an array.</p>

<div class="alert alert-success" role="alert">
  <span class="glyphicon glyphicon-eye-open"></span>
   Only target arrays can be declared without dimension.
</div>

<div class="alert alert-info" role="alert"> 
  <span class="glyphicon glyphicon-eye-open"></span>
  Arrays without dimension can be used to obtain some typecast functionality and allow you to access the same memory via more than one name and type.
</div>

<h4 class="page-header" id="ref-arrays-hostdim">
Arrays with Host Dimension
</h4>

<p>Arrays can have dimensions specified by a host variable, as below:</p>

<pre><code>host uint8 numLeds = 1          // a host array dimension variable
LedState states[numLeds] = {null}
</code></pre>

<p>The value of variable <code>numLeds</code> is computed during the host phase. Thus its value at load time will be known. This 
supports static allocation and initialization for arrays of computed size. Such
an array can adjust to changing requirements without changing source code. Also
static allocation avoids all the problems associated with dynamic memory
management. </p>

<p>More information on host array initialization can be found <a href="http://localhost/~amichi/pollen/guide/host-initialization#ref-hostdata-arrays-hostdim">here</a>.</p>

<h2 class="page-header" id="ref-arrays-access">
Accessing and Modifying an Array
</h2>

<p>Array access uses the <code>[]</code> operator. </p>

<pre><code>  myVar = myArray[i]   // 'i' can be any unary expression
</code></pre>

<p>Assigning an array element is an ordinary assignment with the array element expression on the right hand side. </p>

<pre><code>  myArray[i] = newValue  
</code></pre>

<p>The type of the array element must be compatible with the type of the expression on the other side of the assignment operator. </p>

<h2 class="page-header" id="ref-arrays-iter">
Iterating Over an Array
</h2>

<p>The <code>for</code> and <code>while</code> statements can be used to iterate over an array. <code>strlen()</code>, the function shown below, can be found in the <code>pollen.text</code> package in the bundle <code>pollen.core</code>. </p>

<pre><code>  public uint16 strlen(string s) {
    byte b [] @= s
    uint16 i = 0
    while (b[i] != '\0') {   // look for the string terminator character
      i++
    }
    return i
  }
</code></pre>

<p>In the example below, <code>numLeds</code> is a host variable computed at host time. Its value will default to <code>1</code> if no host initialization assignment occurs.</p>

<pre><code>host uint8 numLeds = 1              // a host array dimension variable
LedState states[numLeds] = {null}    

for (uint8 i = 0; i &lt; numLeds; i++) {
     // process led state element
}
</code></pre>

  
  
</div>


      </div>
    </div>

        <footer class="" role="contentinfo">
      <div class="container section">

          <div class="container">
            <a data-scroll href="http://amaret.com"><img class="brand-logo" src="../../static/img/logo_white_medium.png" /></a>
            <h3 style="margin-top: 0">Integrated Solutions for Product Creation</h3>
            <p>
              Copyright &copy; 2015 Amaret Inc. All rights reserved. <!-- <a href="">Terms of Use</a> &nbsp;|&nbsp;  <a href="">Privacy Policy</a> -->
            </p>
          </div>

      </div>
    </footer>

    <script src="http://code.jquery.com/jquery-1.11.0.min.js"></script>
    <script src="../../static/js/pollen.js"></script>
    <script src="../../static/js/prism.js"></script>


  </body>

</html>
