<!DOCTYPE html>
<html lang="en">

  <head>
    
    <!-- Meta, title, CSS, favicons, etc. -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="Pollen, a new programming language for tiny computers by Amaret, Inc.">
    <meta name="keywords" content="programming, programming languages, languages, hardware, microcontroller, embedded system, embedded systems, embedded systems programming, embedded development, microcontroller software, microcontroller software development">
    <meta name="author" content="Amaret, Inc.">

    <title>Programming Pollen</title>

    <!-- Bootstrap core CSS -->
    <link href="../../static/css/bootstrap.css" rel="stylesheet" />

    <!-- Prism CSS -->
    <link href="../../static/css/prism.css" rel="stylesheet" />

    <!-- Amaret core CSS -->
    <link href="../../static/css/pollen.css" rel="stylesheet" />

    <!-- Favicons -->
    <link rel="apple-touch-icon-precomposed" sizes="144x144" href="static/ico/apple-touch-icon-144-precomposed.png">
    <link rel="icon" href="static/ico/favicon.ico">

    <!-- analytics --> 
    <script></script>
  </head>

  <body class="doc-page language-javascript" data-spy="scroll" data-target="#doc-sidenav">

    <div class="navbar navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target=".navbar-collapse">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="http://localhost/~amichi/pollen/index.html">Pollen</a>
    </div>
    <div class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li id="introduction"><a href="http://localhost/~amichi/pollen/introduction/index.html">Introduction</a></li>
        <li><a href="http://localhost/~amichi/pollen/guide/index.html">Language Guide</a></li>
        <li><a href="http://localhost/~amichi/pollen/reference/index.html">Reference</a></li>
        <li><a href="http://localhost/~amichi/pollen/compiler/index.html">Compiler</a></li>
        <li><a href="">Support</a></li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li><a href="">About</a></li>
      </ul>
    </div>
  </div>
</div>


    <div class="doc-header">
      <div class="container">
        <h1>Programming Pollen</h1>
        <p>A practical guide to the Pollen language features and how to make use of them effectively.</p>
      </div>
    </div>

    <div class="container doc-container" style="padding-bottom: 60px">
      <div class="row" id="content">
        <div class="col-md-3">
  <nav id="doc-sidenav" class="doc-sidebar hidden-print hidden-xs hidden-sm" role="navigation">
    <h4>Language Guide</h4>
<ul class="nav doc-sidenav affix-top" data-spy="affix" data-offset-top="10" data-offset-bottom="200" style="margin-top: 0px">
  <li><a href="http://localhost/~amichi/pollen/guide">The Basics</a></li>
  <li><a href="http://localhost/~amichi/pollen/guide/operators">Basic Operators</a></li>
  <li><a href="http://localhost/~amichi/pollen/guide/strings">Strings and Characters</a></li>
  <li><a href="http://localhost/~amichi/pollen/guide/arrays">Arrays</a></li>
  <li><a href="http://localhost/~amichi/pollen/guide/control-flow">Control Flow</a></li>
  <li><a href="http://localhost/~amichi/pollen/guide/function-references">Function References</a></li>
  <li><a href="http://localhost/~amichi/pollen/guide/host-initialization">Host Initialization</a></li>
  <li><a href="http://localhost/~amichi/pollen/guide/modules">Modules</a></li>
  <li><a href="http://localhost/~amichi/pollen/guide/protocols">Protocols</a></li>  
  <li><a href="http://localhost/~amichi/pollen/guide/compositions">Compositions</a></li>
  <li><a href="http://localhost/~amichi/pollen/guide/classes">Classes</a></li>
  <li><a href="http://localhost/~amichi/pollen/guide/enumerations">Enumerations</a></li>
  <li><a href="http://localhost/~amichi/pollen/guide/meta">Meta Types</a></li>
  <li><a href="http://localhost/~amichi/pollen/guide/print-keyword">Print Keyword</a></li>
  <li><a href="http://localhost/~amichi/pollen/guide/intrinsics">Intrinsics</a></li>
  <li><a href="http://localhost/~amichi/pollen/guide/c-code">C Code Injection</a></li>
  <li><a href="http://localhost/~amichi/pollen/guide/packages-bundles">Packages &amp; Bundles</a></li>
  <li><a href="http://localhost/~amichi/pollen/guide/pollen-corelib">Core Library</a>
    <ul>
        <li><a href="http://localhost/~amichi/pollen/guide/pollen-events">Events</a></li>
        <li><a href="http://localhost/~amichi/pollen/guide/pollen-timers">Timers</a></li>
    </ul>
  </li>
  
</ul>

  </nav>
</div>

<div class="col-md-9" role="main">

  <h1 id="function-refs" class="page-header">Function References</h1>

<p class="lead">
Pollen supports function references. The function which is the type for the
reference declaration must be a module function definition or a protocol
function declaration.
</p>

<p>Here is the declaration of a module function reference. </p>

<pre><code> Mod.foo() f1                 // f1 is a reference to foo() in module Mod 
</code></pre>

<p>Function references can also be references to protocol function declarations.
Here is the declaration of a protocol function reference. Protocol <code>Proto</code> must
contain function declarations for <code>bar()</code> and <code>foo()</code>.</p>

<pre><code> Proto.bar(uint8) f2          // f2 is a reference to a function taking a uint8 

 (uint8 Proto.foo()) f3       // f3 is a reference to a function returning a uint8 
</code></pre>

<p>The function reference <code>f3</code> is declared with a return type. If the function has parameters or a return type that must be represented in the function reference declaration. </p>

<div class="alert alert-warning" role="alert">
  <span class="glyphicon glyphicon-eye-open"></span>
     When a return type is specified in a function reference, the parenthesis around the declaration is required. 
</div>

<p>A host function reference can be declared if its value is a target function.  </p>

<div class="alert alert-warning" role="alert">
  <span class="glyphicon glyphicon-fire"></span>
     A function reference cannot be initialized to a host function.
</div>

<div class="alert alert-info" role="alert">
  <span class="glyphicon glyphicon-leaf"></span>
     The concept of a function reference is not supported in the host time programming environment.
</div>

<p>Below, <code>Mod.foo()</code> is a target function value for a host function reference. If <code>Mod.foo()</code> were a host function neither a host nor target function reference could be assigned to it. </p>

<pre><code> host Mod.foo() f4             // a host function reference to target Mod.foo() 
</code></pre>

<p>Calls through function references are simply the reference name followed by parentheses which may contain parameters (if there are any):</p>

<pre><code>     f1()                      // call Mod.foo()
     f2(7)                     // call Proto.bar(7) 
     uint8 i = f3()            // call Proto.foo()
</code></pre>

<p>Note that <code>f1</code> is fully initialized to a specific module function as a result of the declaration above. It is ready to use. However <code>f2</code> is not ready to use because it is initialized to a protocol function declaration and as such it does not reference a specific module function.  Before <code>f2</code> can be used for calls it must be assigned to a module function with a signature which is compatible to the signature <code>bar(uint8)</code>.  If <code>Mod</code> contains such a function this assignment would do it: </p>

<pre><code>f2 = Mod.bar
</code></pre>

<p>Function references can also be assigned to other function references and passed as parameters to functions if the signatures are compatible. If you are familiar with C, signature compatibility follows C rules.</p>

<div class="alert alert-info" role="alert">
  <span class="glyphicon glyphicon-leaf"></span>
     Class function references are not supported.
</div>

<h4 class="page-header" id="ref-funrefs-events">
Use Case: Function References in the Event Subsystem
</h4>

<p>Using function references to initialize events with handlers is a powerful and
general way to support event handling. Using function references it is easy to create and initialize an event with a handler that executes the actions appropriate for that specific event. </p>

<p>In the <code>pollen-core</code> cloud bundle there is a constructor that takes a handler in the <code>Event</code> class:</p>

<pre><code>import HandlerProtocol as HP

class Event {

  HP.handler() eventHandler = null    # function reference declaration

  public host Event(HP.handler h) {   # function reference parameter
    @eventHandler = h                 # function reference assignment
    Newsroom.registerEventOnHost()
  }
  ...
}
</code></pre>

<p>The protocol definition used in the event subsystem contains the handler declaration:</p>

<pre><code>package pollen.event

protocol HandlerProtocol {

  handler()
}
</code></pre>

<p>The <code>Timer</code> class in the <code>pollen-core</code> cloud bundle creates and initializes an <code>Event</code> with a handler. That code is excerpted below.</p>

<pre><code>class Timer {

  host Event tickEvent

  public host Timer(HP.handler h) {
    tickEvent = new Event(h)            // tickEvent is initialized with a handler 
    TimerManager.registerTimerOnHost(@)
  }
  // ...
}
</code></pre>

<p>It is the timer client who sets the appropriate handler for the timer being
initialized. This reflects the principle of separation of concerns. It is the
client who determines the action for handling the event from what is required in
the client context. That is exemplified above in passing the <code>Event</code> handler to the <code>Timer</code> constructor.</p>

<h4 class="page-header" id="ref-funrefs-generic">
Use Case: Function References for Generic Code
</h4>

<p>Pollen’s object oriented features are designed to be highly efficient in time and space. Pollen does not add any runtime overhead above the C runtime. But having genericity in calls can be very convenient. Here is one way to achieve generic calls in Pollen with no overhead at all. </p>

<p>The example below uses an LedProtocol function reference to function <code>on()</code> as an array type. The array elements are module function references. (Each module implements the protocol LedProtocol). This array is initialized statically to the <code>on()</code> methods of a set of leds. It can be traversed in a for loop to turn all the leds on. </p>

<pre><code>LedProtocol.on on[3] = { Led1.on, Led2.on, Led3.on }
setOn() {
     for (int i = 0; i &lt; 3; i++) {
         on[i]()          // turns on Led1, Led2, Led3
     }
}
</code></pre>
  
  
</div>


      </div>
    </div>

        <footer class="" role="contentinfo">
      <div class="container section">

          <div class="container">
            <a data-scroll href="http://amaret.com"><img class="brand-logo" src="../../static/img/logo_white_medium.png" /></a>
            <h3 style="margin-top: 0">Integrated Solutions for Product Creation</h3>
            <p>
              Copyright &copy; 2015 Amaret Inc. All rights reserved. <!-- <a href="">Terms of Use</a> &nbsp;|&nbsp;  <a href="">Privacy Policy</a> -->
            </p>
          </div>

      </div>
    </footer>

    <script src="http://code.jquery.com/jquery-1.11.0.min.js"></script>
    <script src="../../static/js/pollen.js"></script>
    <script src="../../static/js/prism.js"></script>


  </body>

</html>
