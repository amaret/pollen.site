<!DOCTYPE html>
<html lang="en">

  <head>
    
    <!-- Meta, title, CSS, favicons, etc. -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="Pollen, a new programming language for tiny computers by Amaret, Inc.">
    <meta name="keywords" content="programming, programming languages, languages, hardware, microcontroller, embedded system, embedded systems, embedded systems programming, embedded development, microcontroller software, microcontroller software development">
    <meta name="author" content="Amaret, Inc.">

    <title>Programming Pollen</title>

    <!-- Bootstrap core CSS -->
    <link href="../../static/css/bootstrap.css" rel="stylesheet" />

    <!-- Prism CSS -->
    <link href="../../static/css/prism.css" rel="stylesheet" />

    <!-- Amaret core CSS -->
    <link href="../../static/css/pollen.css" rel="stylesheet" />

    <!-- Favicons -->
    <link rel="apple-touch-icon-precomposed" sizes="144x144" href="static/ico/apple-touch-icon-144-precomposed.png">
    <link rel="icon" href="static/ico/favicon.ico">

    <!-- analytics --> 
    <script></script>
  </head>

  <body class="doc-page language-javascript" data-spy="scroll" data-target="#doc-sidenav">

    <div class="navbar navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target=".navbar-collapse">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="http://localhost/~amichi/pollen/index.html">Pollen</a>
    </div>
    <div class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li id="introduction"><a href="http://localhost/~amichi/pollen/introduction/index.html">Introduction</a></li>
        <li><a href="http://localhost/~amichi/pollen/guide/index.html">Language Guide</a></li>
        <li><a href="http://localhost/~amichi/pollen/reference/index.html">Reference</a></li>
        <li><a href="http://localhost/~amichi/pollen/compiler/index.html">Compiler</a></li>
        <li><a href="">Support</a></li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li><a href="">About</a></li>
      </ul>
    </div>
  </div>
  <div class="alert alert-warning" role="alert" style="text-align: center; margin: 0">
    <p><span class="glyphicon glyphicon-road" aria-hidden="true"></span> This documentation is being worked on and is not yet in a releasable state. &nbsp;2015-04-21</p>
  <p>  </p>
</div>

</div>



    <div class="doc-header draft-mode">
      <div class="container">
        <h1>Programming Pollen</h1>
        <p>A practical guide to the Pollen language features and how to make use of them effectively.</p>
      </div>
    </div>

    <div class="container doc-container" style="padding-bottom: 60px">
      <div class="row" id="content">
        <div class="col-md-3">
  <nav id="doc-sidenav" class="doc-sidebar hidden-print hidden-xs hidden-sm" role="navigation">
    <h4>Language Guide</h4>
<ul class="nav doc-sidenav affix-top" data-spy="affix" data-offset-top="10" data-offset-bottom="200" style="margin-top: 0px">
  <li><a href="http://localhost/~amichi/pollen/guide">The Basics</a></li>
  <li><a href="http://localhost/~amichi/pollen/guide/operators">Basic Operators</a></li>
  <li><a href="http://localhost/~amichi/pollen/guide/strings">Strings and Characters</a></li>
  <li><a href="http://localhost/~amichi/pollen/guide/arrays">Arrays</a></li>
  <li><a href="http://localhost/~amichi/pollen/guide/control-flow">Control Flow</a></li>
  <li><a href="http://localhost/~amichi/pollen/guide/function-references">Function References</a></li>
  <li><a href="http://localhost/~amichi/pollen/guide/host-initialization">Host Initialization</a></li>
  <li><a href="http://localhost/~amichi/pollen/guide/modules">Modules</a></li>
  <li><a href="http://localhost/~amichi/pollen/guide/protocols">Protocols</a></li>  
  <li><a href="http://localhost/~amichi/pollen/guide/compositions">Compositions</a></li>
  <li><a href="http://localhost/~amichi/pollen/guide/classes">Classes</a></li>
  <li><a href="http://localhost/~amichi/pollen/guide/enumerations">Enumerations</a></li>
  <li><a href="http://localhost/~amichi/pollen/guide/meta">Meta Types</a></li>
  <li><a href="http://localhost/~amichi/pollen/guide/print-keyword">Print Keyword</a></li>
  <li><a href="http://localhost/~amichi/pollen/guide/intrinsics">Intrinsics</a></li>
  <li><a href="http://localhost/~amichi/pollen/guide/c-code">C Code Injection</a></li>
  <li><a href="http://localhost/~amichi/pollen/guide/packages-bundles">Packages &amp; Bundles</a></li>
  <li><a href="http://localhost/~amichi/pollen/guide/pollen-corelib">Core Library</a>
    <ul>
        <li><a href="http://localhost/~amichi/pollen/guide/pollen-events">Events</a></li>
        <li><a href="http://localhost/~amichi/pollen/guide/pollen-timers">Timers</a></li>
    </ul>
  </li>
  
</ul>

  </nav>
</div>

<div class="col-md-9" role="main">

  
<h2 id="how-to-use-events">How to Use Events</h2>

<p>In package <code>pollen.event</code> there are four types which support the event subsystem: <code>Event</code>, <code>Newsroom</code>, <code>HandlerProtocol</code>, and <code>EventQueue</code>. </p>

<ul>
  <li>
    <p><code>Event</code>.
Applications that use events will use this class. Code to create, post, and fire events is here. The event handler is initialized in the constructor and you can also call a function to set the handler after construction. </p>
  </li>
  <li>
    <p><code>Newsroom</code>.
The <code>Newsroom</code> class handles administration and registration of events. The event subsystem runs in a loop and it is necessary to call <code>Newsroom.run()</code> to start that loop but otherwise calls to <code>Newsroom</code> are usually not necessary in client code. </p>
  </li>
  <li>
    <p><code>HandlerProtocol</code>.
This protocol defines a signature for handlers used by events.</p>
  </li>
  <li>
    <p><code>EventQueue</code>.
Used by <code>Newsroom</code>.</p>
  </li>
</ul>

<p>The timer subsystem creates events in a manner similar to the way a typical Pollen application would; it is the <code>Timer</code> class which creates and initializes an event. It is the timer clients who start the event subsystem by calling <code>Newsroom.run()</code>. We highlight this call in our <code>TimerBlink</code> example below.</p>

<pre><code>import pollen.environment as Env
from Env import Led

from pollen.time import Timer

module TimerBlink {

  host new Timer t1(tick)    

  tick() {
    Led.toggle()
  }

  pollen.run() {
    t1.start(500, true)      
    Env.Newsroom.run()      // start the event subsystem
  }
}
</code></pre>

<p><code>Newsroom</code> provides support for a simple loop dispatcher where queued events are dispatched in FIFO order. The loop runs indefinitely. Each event handler runs to completion. This loop is initiated by the call to <code>run()</code>. This simple approach is suitable to many embedded applications which run with extremely tight memory and time constraints and cannot host even a scaled down microkernel RTOS. It is also more deterministic than dispatchers that use priority and that is important in saftey critical applications. This approach conforms to a pattern common to embedded applications and Pollen provides support for it in package <code>pollen.event</code>. Of course you can use Pollen with other approaches. </p>

<p>The <code>Timer</code> class encapsulates the timer event. To show an <code>Event</code> example we extract the code in the <code>Timer</code> class which uses the event subsystem.</p>

<pre><code>from pollen.event import HandlerProtocol as HP  // import the HandlerProtocol
from pollen.event import Event                  // import the Event class
import TimerManager

class Timer {  

  host Event tickEvent                          // declare an Event
  bool active = false
  bool periodic = false
  uint16 duration = 0
  uint16 tickCount = 0
  // ...
  public host Timer(HP.handler h) {   
    tickEvent = new Event(h)                    // initialize an Event with a handler
    TimerManager.registerTimerOnHost(@)
  }  
  // ...
  public fire() {
    tickEvent.fire()                            // fire the event 
  }
  // ...
  public tick() {
    if (@active) {
      @tickCount++
      if (@tickCount == @duration) {
        @tickEvent.post()                       // post the Event.
        if (@periodic) {
          @tickCount = 0
        } else {
          @stop()
        }
      }
    }
  }
  // ...
}
</code></pre>

<p>The <code>tick()</code> function in <code>Timer</code> is called by the <code>TimerManager</code> (which is the controller for hardware timer interrupts). When the interval specified by the timer client has passed, a tick will result in the posting of a <code>tickEvent</code>. That means the <code>tickEvent</code> will be added to the <code>EventQueue</code> for eventual dispatch by <code>Newsroom</code>. </p>

<p>To use the event subsystem a client application follows these steps:</p>

<ol>
  <li>
    <p>Declare an <code>Event</code>.</p>
  </li>
  <li>
    <p>Define an <code>Event</code> handler.</p>
  </li>
  <li>
    <p>Initialize the <code>Event</code> with handler. </p>
  </li>
  <li>
    <p>Call <code>Newsroom.run()</code>. This call will not return. The <code>Newsroom</code> dispatch loop will run indefinitely. </p>
  </li>
</ol>

<p>You must also post events, according to your application logic. </p>
  
  
</div>


      </div>
    </div>

        <footer class="" role="contentinfo">
      <div class="container section">

          <div class="container">
            <a data-scroll href="http://amaret.com"><img class="brand-logo" src="../../static/img/logo_white_medium.png" /></a>
            <h3 style="margin-top: 0">Integrated Solutions for Product Creation</h3>
            <p>
              Copyright &copy; 2015 Amaret Inc. All rights reserved. <!-- <a href="">Terms of Use</a> &nbsp;|&nbsp;  <a href="">Privacy Policy</a> -->
            </p>
          </div>

      </div>
    </footer>

    <script src="http://code.jquery.com/jquery-1.11.0.min.js"></script>
    <script src="../../static/js/pollen.js"></script>
    <script src="../../static/js/prism.js"></script>


  </body>

</html>
